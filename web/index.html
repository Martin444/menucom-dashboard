<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

                 }, 1000); // Reducir tiempo para una transici√≥n m√°s suave  This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="google-signin-client_id" content="1053737382833-49iodle61i3kmdte9uocoij5hdg263nk.apps.googleusercontent.com">
  <meta name="referrer" content="no-referrer-when-downgrade">
  <meta name="description" content="Administracion para Menu com">

  <!-- Google Sign-In Platform Library -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Menu com dashboard">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <link rel="apple-touch-icon" href="logomenucom.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="logomenucom.png"/>

  <title>Menucom dashboard</title>
  <link rel="manifest" href="manifest.json">

  <!-- Firebase Core JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  
  <!-- Firebase Auth JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  
  <!-- Initialize Firebase -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAEWpBCNon00zwt1eWfqSDiYMhH0xxLMwk",
      authDomain: "menucom-ff087.firebaseapp.com",
      projectId: "menucom-ff087",
      storageBucket: "menucom-ff087.firebasestorage.app",
      messagingSenderId: "1053737382833",
      appId: "1:1053737382833:web:d4173f40d6b88a52900390",
      measurementId: "G-D5ZC2VB6GR"
    };
    
    try {
      firebase.initializeApp(firebaseConfig);
      console.log('üî• [FIREBASE] Firebase inicializado correctamente');
      console.log('üìã [FIREBASE] Proyecto:', firebaseConfig.projectId);
      console.log('üîë [FIREBASE] App name:', firebase.app().name);
      console.log('üîê [FIREBASE] Auth instance:', firebase.auth());
    } catch (error) {
      console.error('‚ùå [FIREBASE] Error inicializando Firebase:', error);
      // No bloquear la carga si Firebase falla
    }
  </script>

<!-- 
  <script>
    // The value below is injected by flutter build, do not touch.
  </script> -->
  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js" defer></script>
  <!-- Agregar estilo para el contenedor del loader -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    #loader {
      position: fixed;
      z-index: 9999;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #AEE1F9;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;  
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      overflow: hidden;
    }
    
    /* Elemento decorativo inferior dentado */
    #loader::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40px;
      background: #FFFFFF;
      clip-path: polygon(0% 100%, 5% 0%, 10% 100%, 15% 0%, 20% 100%, 25% 0%, 30% 100%, 35% 0%, 40% 100%, 45% 0%, 50% 100%, 55% 0%, 60% 100%, 65% 0%, 70% 100%, 75% 0%, 80% 100%, 85% 0%, 90% 100%, 95% 0%, 100% 100%);
    }
    
    /* Animaciones de fondo minimalistas */
    #loader::before {
      content: '';
      position: absolute;
      top: 20px;
      right: 20px;
      width: 100px;
      height: 100px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      animation: float 6s ease-in-out infinite;
    }
    
    #loader.hidden {
      opacity: 0;
      transition: opacity 0.8s ease-out;
    }
    
    /* Logo container con est√©tica minimalista */
    .logo-container {
      position: relative;
      margin-bottom: 50px;
      z-index: 10;
    }
    
    .logo-container img {
      width: 140px;
      height: 140px;
      border-radius: 0;
      box-shadow: 0 8px 32px rgba(255,255,255,0.3);
      animation: subtleFloat 4s ease-in-out infinite;
      filter: contrast(1.1) brightness(1.05);
      background: rgba(255,255,255,0.9);
      padding: 10px;
    }
    
    /* Indicador de carga minimalista */
    .spinner-container {
      position: relative;
      margin-bottom: 40px;
      z-index: 10;
    }
    
    #loader .spinner {
      width: 80px;
      height: 4px;
      position: relative;
      margin: 0 auto;
      background: rgba(255,255,255,0.3);
      border-radius: 2px;
      overflow: hidden;
    }
    
    .spinner::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, #FFFFFF, transparent);
      animation: loading 2s infinite;
    }
    
    /* Texto del loader con est√©tica limpia */
    .loader-text {
      color: #4A4A4A;
      text-align: center;
      font-weight: 400;
      font-size: 16px;
      max-width: 300px;
      padding: 0 20px;
      z-index: 10;
      position: relative;
      line-height: 1.5;
    }
    
    .loader-text span {
      transition: opacity 0.5s ease-in-out;
      display: block;
    }
    
    /* Elementos geom√©tricos minimalistas */
    .geometric-element {
      position: absolute;
      background: rgba(255,255,255,0.2);
      z-index: 1;
    }
    
    .geometric-element:nth-child(1) { 
      width: 60px; 
      height: 2px; 
      top: 15%; 
      left: 10%; 
      animation: slide 8s infinite linear; 
    }
    .geometric-element:nth-child(2) { 
      width: 2px; 
      height: 40px; 
      top: 25%; 
      right: 15%; 
      animation: slide 6s infinite linear reverse; 
    }
    .geometric-element:nth-child(3) { 
      width: 30px; 
      height: 30px; 
      border-radius: 50%; 
      bottom: 20%; 
      left: 20%; 
      animation: pulse 4s infinite ease-in-out; 
    }
    
    /* Animaciones minimalistas */
    @keyframes float {
      0%, 100% { 
        transform: translateY(0px);
        opacity: 0.3;
      }
      50% { 
        transform: translateY(-20px);
        opacity: 0.6;
      }
    }
    
    @keyframes subtleFloat {
      0%, 100% { 
        transform: translateY(0px) scale(1);
      }
      50% { 
        transform: translateY(-8px) scale(1.02);
      }
    }
    
    @keyframes loading {
      0% {
        left: -100%;
      }
      100% {
        left: 100%;
      }
    }
    
    @keyframes slide {
      0% {
        transform: translateX(0px);
        opacity: 0.2;
      }
      50% {
        opacity: 0.5;
      }
      100% {
        transform: translateX(30px);
        opacity: 0.2;
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.3;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.6;
      }
    }
    
    /* Responsivo */
    @media (max-width: 768px) {
      .logo-container img {
        width: 120px;
        height: 120px;
      }
      
      .loader-text {
        font-size: 14px;
        max-width: 280px;
      }
      
      #loader .spinner {
        width: 60px;
      }
      
      .geometric-element:nth-child(1) { width: 40px; }
      .geometric-element:nth-child(2) { height: 30px; }
      .geometric-element:nth-child(3) { width: 20px; height: 20px; }
    }
    
    @media (max-width: 480px) {
      .logo-container img {
        width: 100px;
        height: 100px;
        padding: 8px;
      }
      
      .loader-text {
        font-size: 13px;
        max-width: 250px;
      }
    }
  </style>
</head>
<body>

  <!-- Loader con nueva est√©tica minimalista -->
  <div id="loader">
    <!-- Elementos geom√©tricos decorativos -->
    <div class="geometric-element"></div>
    <div class="geometric-element"></div>
    <div class="geometric-element"></div>
    
    <!-- Logo -->
    <div class="logo-container">
      <img src="logomenucom.png" alt="MenuCom Logo">
    </div>
    
    <!-- Indicador de carga minimalista -->
    <div class="spinner-container">
      <div class="spinner"></div>
    </div>
    
    <!-- Texto del loader -->
    <div class="loader-text">
      <span>Preparando tu experiencia culinaria...</span>
    </div>
  </div>
  <script>
    // Script actualizado para la nueva est√©tica minimalista
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üé® [SPLASH] Inicializando splash screen minimalista...');
      
      // Verificar que todos los elementos est√©n presentes
      var loader = document.getElementById('loader');
      var logoContainer = document.querySelector('.logo-container');
      var logoImg = document.querySelector('.logo-container img');
      var spinner = document.querySelector('.spinner');
      var textElement = document.querySelector('.loader-text span');
      
      console.log('üìã [SPLASH] Elementos encontrados:');
      console.log('  - Loader:', !!loader);
      console.log('  - Logo Container:', !!logoContainer);
      console.log('  - Logo Image:', !!logoImg);
      console.log('  - Spinner:', !!spinner);
      console.log('  - Text Element:', !!textElement);
      
      if (logoImg) {
        console.log('üñºÔ∏è [SPLASH] Logo src:', logoImg.src);
        
        // Verificar carga del logo
        logoImg.onload = function() {
          console.log('‚úÖ [SPLASH] Logo cargado exitosamente');
        };
        
        logoImg.onerror = function() {
          console.error('‚ùå [SPLASH] Error cargando logo desde:', logoImg.src);
          // Fallback: mostrar un √≠cono de texto
          logoImg.style.display = 'none';
          logoContainer.innerHTML = '<div style="width: 140px; height: 140px; background: rgba(255,255,255,0.9); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: #4A4A4A; font-weight: bold;">MC</div>';
        };
      }
      
      // Verificar que el estilo del loader est√© aplicado
      if (loader) {
        var computedStyle = window.getComputedStyle(loader);
        console.log('üé® [SPLASH] Estilo del loader:');
        console.log('  - Background:', computedStyle.backgroundColor);
        console.log('  - Display:', computedStyle.display);
        console.log('  - Position:', computedStyle.position);
      }
      
      // Mensajes minimalistas y profesionales
      const messages = [
        'Preparando tu experiencia culinaria...',
        'Cargando panel de administraci√≥n... üçΩÔ∏è',
        'Conectando con tu negocio... ‚ö°',
        'Organizando tu men√∫ digital... üìã',
        'Casi listo para empezar... ‚ú®'
      ];
      
      let messageIndex = 0;
      const loaderTextElement = document.querySelector('.loader-text span');
      
      const updateMessage = () => {
        if (loaderTextElement) {
          loaderTextElement.style.opacity = '0';
          setTimeout(() => {
            loaderTextElement.textContent = messages[messageIndex];
            loaderTextElement.style.opacity = '1';
            messageIndex = (messageIndex + 1) % messages.length;
          }, 400);
        }
      };
      
      // Cambiar mensaje cada 4 segundos para una experiencia m√°s calmada
      const messageInterval = setInterval(updateMessage, 4000);
      
      // Limpiar intervalo cuando se oculte el loader
      window.hideLoaderInterval = messageInterval;
    });
    
    // Funci√≥n para manejar errores durante la carga
    function handleSplashError(errorType, error) {
      console.error('üî• [SPLASH ERROR]', errorType, ':', error);
      
      // Mostrar error en el splash
      var errorTextElement = document.querySelector(".loader-text span");
      var spinnerElement = document.querySelector(".spinner");
      
      if (errorTextElement) {
        errorTextElement.innerHTML = "‚ö†Ô∏è Error al cargar la aplicaci√≥n";
        errorTextElement.style.color = "#FF6B6B";
      }
      
      // Ocultar spinner y mostrar informaci√≥n de error
      if (spinnerElement) {
        spinnerElement.style.display = "none";
      }
      
      // Crear un contenedor de error detallado
      var errorContainer = document.createElement('div');
      errorContainer.style.cssText = `
        margin-top: 20px;
        padding: 15px;
        background: rgba(255, 107, 107, 0.1);
        border: 1px solid #FF6B6B;
        border-radius: 8px;
        max-width: 400px;
        text-align: left;
        font-size: 12px;
        color: #4A4A4A;
        font-family: 'Courier New', monospace;
      `;
      
      errorContainer.innerHTML = `
        <strong style="color: #FF6B6B;">Detalles del Error:</strong><br>
        <strong>Tipo:</strong> ${errorType}<br>
        <strong>Mensaje:</strong> ${error.message || 'Error desconocido'}<br>
        <strong>Stack:</strong> ${error.stack ? error.stack.substring(0, 200) + '...' : 'No disponible'}<br><br>
        <em style="color: #666;">Por favor, recarga la p√°gina o contacta al administrador.</em>
      `;
      
      var loaderElement = document.getElementById('loader');
      if (loaderElement) {
        loaderElement.appendChild(errorContainer);
      }
      
      // Agregar bot√≥n de recarga
      var reloadButton = document.createElement('button');
      reloadButton.innerHTML = 'üîÑ Recargar P√°gina';
      reloadButton.style.cssText = `
        margin-top: 15px;
        padding: 10px 20px;
        background: #4A4A4A;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s ease;
      `;
      
      reloadButton.onmouseover = function() { this.style.background = '#666'; };
      reloadButton.onmouseout = function() { this.style.background = '#4A4A4A'; };
      reloadButton.onclick = function() {
        console.log('üîÑ [SPLASH] Usuario solicit√≥ recarga de p√°gina');
        window.location.reload();
      };
      
      if (loaderElement) {
        loaderElement.appendChild(reloadButton);
      }
      
      // Log detallado para debugging
      console.group('üîç [SPLASH DEBUG INFO]');
      console.log('Error Type:', errorType);
      console.log('Error Object:', error);
      console.log('User Agent:', navigator.userAgent);
      console.log('URL:', window.location.href);
      console.log('Timestamp:', new Date().toISOString());
      console.groupEnd();
    }
    
    window.addEventListener('load', function(ev) {
      console.log('üöÄ [SPLASH] Iniciando carga de la aplicaci√≥n Flutter...');
      
      try {
        {{flutter_js}}
        {{flutter_build_config}}
        
        // Download main.dart.js
        var serviceWorkerVersion = '{{flutter_service_worker_version}}'.replace('"','');
        console.log('üì¶ [SPLASH] Service Worker Version:', serviceWorkerVersion);
        
        var loaderConfig = {
          serviceWorker: {
            serviceWorkerVersion: "",
            serviceWorkerUrl: "/"+serviceWorkerVersion+".js?v=",
          },
          entrypointUrl: '/main.dart.js?v=' + serviceWorkerVersion,
          onEntrypointLoaded: function(engineInitializer) {
            console.log('‚úÖ [SPLASH] Entrypoint cargado exitosamente');
            
            try {
              engineInitializer.initializeEngine({renderer: "canvaskit"}).then(function(appRunner) {
                console.log('üéØ [SPLASH] Motor Flutter inicializado');
                
                var flutterTextElement = document.querySelector(".loader-text span");
                if (flutterTextElement) {
                  flutterTextElement.innerHTML = "Finalizando configuraci√≥n... ‚öôÔ∏è";
                }
                
                return appRunner.runApp();
              }).then(function() {
                console.log('üéâ [SPLASH] Aplicaci√≥n Flutter ejecut√°ndose correctamente');
                
                // Limpiar intervalo de mensajes
                if (window.hideLoaderInterval) {
                  clearInterval(window.hideLoaderInterval);
                }
                
                // Ocultar loader con animaci√≥n suave
                setTimeout(function() {
                  var container = document.getElementById("loader");
                  if (container) {
                    console.log('ü´• [SPLASH] Ocultando splash screen...');
                    container.classList.add("hidden");
                    // Remover del DOM despu√©s de la animaci√≥n
                    setTimeout(function() {
                      container.style.display = "none";
                      console.log('‚ú® [SPLASH] Splash screen removido del DOM');
                    }, 500);
                  }
                }, 1500);
              }).catch(function(error) {
                console.error('‚ùå [SPLASH] Error ejecutando la aplicaci√≥n Flutter:', error);
                handleSplashError('Error al ejecutar la aplicaci√≥n', error);
              });
            } catch (error) {
              console.error('‚ùå [SPLASH] Error inicializando el motor Flutter:', error);
              handleSplashError('Error al inicializar el motor Flutter', error);
            }
          }
        };
        
        console.log('üìã [SPLASH] Configuraci√≥n del loader:', loaderConfig);
        _flutter.loader.load(loaderConfig);
        
      } catch (error) {
        console.error('‚ùå [SPLASH] Error cr√≠tico durante la carga inicial:', error);
        handleSplashError('Error cr√≠tico en la carga inicial', error);
      }
    });
  </script>
  
  <!-- Google Sign-In elements con manejo mejorado de errores -->
  <div id="g_id_onload"
     data-client_id="1053737382833-49iodle61i3kmdte9uocoij5hdg263nk.apps.googleusercontent.com"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
  </div>
  <script>
    function handleCredentialResponse(response) {
      console.log('üîê [GOOGLE-SIGNIN] Respuesta recibida:', response);
      
      try {
        if (window.flutter_inappwebview) {
          console.log('üì± [GOOGLE-SIGNIN] Enviando a flutter_inappwebview...');
          window.flutter_inappwebview.callHandler('handleGoogleSignIn', response.credential);
        }
        
        // Para web, podemos usar postMessage o callbacks globales
        if (window.handleGoogleSignInCallback) {
          console.log('üåê [GOOGLE-SIGNIN] Ejecutando callback global...');
          window.handleGoogleSignInCallback(response.credential);
        }
        
        console.log('‚úÖ [GOOGLE-SIGNIN] Credenciales procesadas exitosamente');
      } catch (error) {
        console.error('‚ùå [GOOGLE-SIGNIN] Error procesando credenciales:', error);
      }
    }
    
    // Agregar listener para errores de Google Sign-In
    window.addEventListener('error', function(event) {
      if (event.error && event.error.message && event.error.message.includes('gsi')) {
        console.error('‚ùå [GOOGLE-SIGNIN] Error en Google Sign-In SDK:', event.error);
      }
    });
    
    // Suprimir errores de FedCM que son normales en desarrollo
    window.addEventListener('unhandledrejection', function(event) {
      if (event.reason && event.reason.message && 
          (event.reason.message.includes('FedCM') || 
           event.reason.message.includes('NetworkError: Error retrieving a token'))) {
        console.warn('‚ö†Ô∏è [GOOGLE-SIGNIN] FedCM error suprimido (normal en desarrollo):', event.reason.message);
        event.preventDefault(); // Prevenir que se muestre en consola como error no manejado
      }
    });
  </script>
</body>
</html>
